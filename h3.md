# h3

## a

> Solve four riddles from WebGoat. Skip the ones that are "for developer version
> only" or require modifying WebGoat source code inside Docker container. You
> can use any tasks, but the ones near the start are easier. Explain step by
> step how you exploited the app. (For this task, you'll need to install
> WebGoat. Check links and literature above. WebGoat runs on your own machine,
> so make sure the address starts with "localhost")

The very first thing was to update the VirtualBox and the Guest Additions. At
first the bidirectional clip board wasn't working, and using copy paste between
host and guest system helps tremendously. After that following installation
instructions for Docker and WebGoat was very easy. I have to mention here that
`docker.io` package is [no longer the preferred method][1] of installing Docker
on Ubuntu, but I already spent a bit too much time with the Guest Additions, so
I didn't update Docker for this task.

### Bypass a Path Based Access Control Scheme

I used Firefox's developer tools to edit the HTML values for select box.
At first I tried to set first options value to `WEB-INF/spring-security.xml`,
but I only got error message: "No such file or directory".

Value of `../` returned error message: "Is a directory", so I guess

Value of `../*` returned agail "No such file or directory" -message.

An exact filename seems to be required for this to work. I went up the directory
tree `../../../WEB-INF/spring-security.xml`, and got a new message from WebGoat:

> It appears that you are on the right track. Commands that may compromise the
> operating system have been disabled. You are only allowed to see one file in
> this directory.

I'm not sure what this means but it's a good sign I guess. Going up one more
level resulted again tin No such file or directory -error. So the right palce
seems to be the `../../../WEB-INF/`. I just can figure out what is the one file
that is allowed to be seen.

I had to resort to view the solution, which eplained that

> ...replacing it with `../main.jsp` which is a file located in a folder below
> the current directory.
>
> Current Directory is:
> `/.extract/webapps/WebGoat/plugin_extracted/plugin/StoredXss/lessonPlans/en`

So I tried to replace the value with `../main.jsp` and still got an error: "The
following error occurred while accessing the file: `/.extract/webapps/WebGoat/plugin_extracted/plugin/PathBasedAccessControl/lessonPlans/en/../main.jsp`
(No such file or directory)"

Either there is something wrong with my WebGoat setup, or the solution is wrong.

But I was determined to find this mystery .jsp-file, so I hunted it down from my
container named `relaxed_goodall`.

```shell
docker exec -it relaxed_goodall find /.extract -name main.jsp
/.extract/webapps/WebGoat/main.jsp
```

That lead to victory:

> Congratulations! Access to file allowed. ==> `/.extract/webapps/WebGoat/main.jsp`
>
> Current Directory is: `/.extract/webapps/WebGoat/plugin_extracted/plugin/StoredXss/lessonPlans/en`

It seems that to find the main.jsp file one has to walk five levels up the
directory tree. Not just three (or one as the solution suggested).

So the solution was to set one options value to
`../../../../../main.jsp`. This gave access to the whole file.

```java
Viewing file: /.extract/webapps/WebGoat/main.jsp<%@ page contentType="text/html; charset=ISO-8859-1" language="java"
import="org.owasp.webgoat.session.*, org.owasp.webgoat.lessons.Category, org.owasp.webgoat.lessons.AbstractLesson, org.owasp.webgoat.util.*, java.util.*"
errorPage="" %>
<%
WebSession webSession = ((WebSession) session.getAttribute(WebSession.SESSION));
Course course = webSession.getCourse();
AbstractLesson currentLesson = webSession.getCurrentLesson();
LabelManager labelManager = BeanProvider.getBean("labelManager", LabelManager.class);
%>
...
and so on
```

I have to say that this task was a bit difficult without any knowledge on how
Java's web applications are structured.

### Riddle 2

### Riddle 3

### Riddle 4


## b

> Use OWASP 10 to name each type of vulnerability you used in part a.

## c

> Real life? For each of the vulnerabilites you found, explain how it could be
> used in real life. For example, if you get a javascript alert, so what? How
> common do you think that this vulnerability is? Can you find any reference
> to support your view? (Non-academic references are OK)

## d

> How could companies protect themselves against the problems you considered
> in a-c? Try to view this on different levels, from code to strategy.

## e

> Voluntary: Solve 15 WebGoat challenges. It makes sense to use as simple and
> easy to use tools as possible, but you might need something more. In case you
> need it, mitmproxy is my favourite testing proxy.

## f

> Voluntary: Invited. Get an invite to Hack The Box. This is a simple
> javascript/web hacking challenge. Stay within scope.
> <https://www.hackthebox.eu/invite> (ps. If you do get an invite: If you get
> inside the network and set up VPN, only continue if you know how to use the
> required tools safely; understand their rules; follow your tools with other
> tools; double-triple check IP addresses; and stay within the scope given.)

[1]: <https://docs.docker.com/engine/install/ubuntu/>